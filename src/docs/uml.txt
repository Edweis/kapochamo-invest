@startuml
title Kapochamo-Invest scrapping architecture

control Cloudwatch as cw
entity "Watcher λ" as watcher
boundary "Binance news" as binance_news
entity "Trader λ" as trader
boundary "Binance API" as binance_api

note over watcher
    env:
    LATEST_NEWS_TITLE
end note
note over trader
    env:
    STRATEGY
    TIMEOUT_SELL_AFTER
    BINANCE_API_KEY
end note

loop every minute
    cw -> watcher: async invoke()
    watcher -> binance_news: GET market/all
    watcher <-- binance_news: latest news
    alt news is actually new
        watcher -> watcher: extract symbols from news
        loop each symbol
            watcher -> trader: async invoke(symbol)
            loop until strategy validates OR timeout exceeded
                trader <-- binance_api: WebSocket get klines
                trader -> binance_api: POST buy symbol from first tick
                ...wait until strategy is validated...
                trader -> binance_api: POST sell symbol
            end loop
        end loop
    else failed
    end
end loop
@enduml
